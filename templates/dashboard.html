<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>${PAGE_TITLE} | NEXUS OPS</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;500;700&family=JetBrains+Mono:wght@400;700&display=swap"
        rel="stylesheet">
    <script src="https://cdn.bootcdn.net/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <style>
        /* --- 核心变量 --- */
        :root {
            --bg-deep: #050505;
            --bg-panel: rgba(20, 25, 35, 0.7);
            --primary: #00f3ff;
            --secondary: #7000ff;
            --accent: #ff0055;
            --text-main: #e0f7fa;
            --text-dim: #6c8498;
            --glass: blur(12px);
            --border-glow: 0 0 10px rgba(0, 243, 255, 0.2);
            --font-head: 'Orbitron', sans-serif;
            --font-body: 'Rajdhani', sans-serif;
            --font-code: 'JetBrains Mono', monospace;
        }

        /* --- 全局基础 --- */
        body {
            margin: 0;
            background-color: var(--bg-deep);
            color: var(--text-main);
            font-family: var(--font-body);
            overflow-x: hidden;
            background-image:
                radial-gradient(circle at 50% 0%, #1a1a2e 0%, transparent 60%),
                linear-gradient(0deg, transparent 24%, rgba(0, 243, 255, .03) 25%, rgba(0, 243, 255, .03) 26%, transparent 27%, transparent 74%, rgba(0, 243, 255, .03) 75%, rgba(0, 243, 255, .03) 76%, transparent 77%, transparent);
            background-size: 100% 100%, 50px 50px;
        }

        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }

        ::-webkit-scrollbar-track {
            background: #000;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 3px;
        }

        /* --- 顶部 Banner 区域 (Hero Section) --- */
        .hero-section {
            position: relative;
            height: 500px;
            width: 100%;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-bottom: 2px solid var(--primary);
            background: radial-gradient(circle, rgba(0, 243, 255, 0.1) 0%, rgba(0, 0, 0, 0.8) 80%);
        }

        .hero-content {
            z-index: 10;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(0, 0, 0, 0.8);
            pointer-events: none;
            /* 让鼠标能穿透文字操作后面的轮播 */
        }

        .hero-title {
            font-family: var(--font-head);
            font-size: 3rem;
            text-transform: uppercase;
            letter-spacing: 4px;
            background: linear-gradient(to bottom, #fff, var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 0;
        }

        .hero-subtitle {
            font-family: var(--font-code);
            color: var(--primary);
            font-size: 0.9rem;
            margin-top: 5px;
            background: rgba(0, 0, 0, 0.6);
            padding: 2px 10px;
            display: inline-block;
        }

        /* 3D 旋转木马容器 */
        .carousel-container {
            position: absolute;
            top: 55%;
            /* 下移一点 */
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 300px;
            perspective: 1000px;
            z-index: 5;
        }

        .carousel-track {
            position: relative;
            width: 100%;
            height: 100%;
            transform-style: preserve-3d;
            transition: transform 1s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        /* 轮播卡片 */
        .carousel-item {
            position: absolute;
            width: 400px;
            height: 250px;
            left: 50%;
            top: 50%;
            margin-left: -200px;
            /* 居中 */
            margin-top: -125px;
            border: 1px solid var(--primary);
            background: rgba(0, 0, 0, 0.8);
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.2);
            cursor: pointer;
            transition: all 0.5s;
            overflow: hidden;
            -webkit-box-reflect: below 10px linear-gradient(transparent, transparent, rgba(0, 0, 0, 0.4));
        }

        .carousel-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            /* 保持比例填满 */
            filter: grayscale(0.5) contrast(1.2);
            transition: filter 0.3s;
        }

        .carousel-item:hover img,
        .carousel-item.active img {
            filter: grayscale(0) contrast(1);
        }

        .carousel-caption {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(0, 0, 0, 0.9);
            color: var(--primary);
            font-family: var(--font-code);
            font-size: 0.8rem;
            padding: 5px;
            text-align: center;
            transform: translateY(100%);
            transition: transform 0.3s;
        }

        .carousel-item:hover .carousel-caption {
            transform: translateY(0);
        }

        /* 轮播控制按钮 */
        .carousel-nav {
            position: absolute;
            bottom: 20px;
            z-index: 20;
            display: flex;
            gap: 20px;
        }

        .nav-btn-circle {
            width: 40px;
            height: 40px;
            border: 1px solid var(--primary);
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.5);
            color: var(--primary);
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .nav-btn-circle:hover {
            background: var(--primary);
            color: #000;
            box-shadow: 0 0 15px var(--primary);
        }

        /* --- 主导航 --- */
        .main-nav {
            display: flex;
            justify-content: center;
            background: rgba(0, 0, 0, 0.8);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .nav-tab {
            padding: 15px 40px;
            cursor: pointer;
            font-family: var(--font-head);
            color: var(--text-dim);
            transition: 0.3s;
            position: relative;
            text-transform: uppercase;
        }

        .nav-tab.active {
            color: #fff;
            text-shadow: 0 0 10px #fff;
        }

        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--primary);
            box-shadow: 0 -2px 10px var(--primary);
        }

        /* --- 内容布局 --- */
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .content-section {
            display: none;
            opacity: 0;
            animation: fadeIn 0.5s forwards;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
            }
        }

        /* --- 模块卡片 --- */
        .module-card {
            background: var(--bg-panel);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            margin-bottom: 30px;
            overflow: hidden;
            position: relative;
        }

        /* 装饰角 */
        .module-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 20px;
            height: 20px;
            border-top: 2px solid var(--primary);
            border-left: 2px solid var(--primary);
        }

        .module-card::after {
            content: '';
            position: absolute;
            bottom: 0;
            right: 0;
            width: 20px;
            height: 20px;
            border-bottom: 2px solid var(--primary);
            border-right: 2px solid var(--primary);
        }

        .module-header {
            padding: 15px 20px;
            background: linear-gradient(90deg, rgba(0, 243, 255, 0.05), transparent);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            font-family: var(--font-head);
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .module-body {
            padding: 20px;
        }

        /* --- 关键修正：图表防堆叠容器 --- */
        .chart-scroll-wrapper {
            width: 100%;
            overflow-x: auto;
            /* 允许横向滚动 */
            padding-bottom: 10px;
        }

        .chart-container {
            /* 强制最小宽度，确保文字不堆叠 */
            min-width: 800px;
            height: 450px;
            position: relative;
        }

        /* 针对特别密集的图表，可以单独设置更宽 */
        .wide-chart {
            min-width: 1200px;
        }

        /* --- 指标网格 --- */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .kpi-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.03), rgba(0, 0, 0, 0.2));
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 4px;
            text-align: center;
            transition: transform 0.3s;
        }

        .kpi-card:hover {
            transform: translateY(-5px);
            border-color: var(--secondary);
            box-shadow: 0 5px 20px rgba(112, 0, 255, 0.2);
        }

        .kpi-title {
            font-size: 0.8rem;
            color: var(--text-dim);
            letter-spacing: 1px;
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        .kpi-value {
            font-family: var(--font-code);
            font-size: 2rem;
            color: #fff;
            font-weight: bold;
        }

        /* --- 列表样式 --- */
        .data-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 10px;
        }

        .list-item {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px 15px;
            border-left: 3px solid var(--text-dim);
            font-family: var(--font-code);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .list-item:hover {
            border-left-color: var(--accent);
            background: rgba(255, 0, 85, 0.05);
        }

        /* --- 布局辅助 --- */
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media(max-width: 1000px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
        }

        /* 隐藏原始数据源，JS会移动它们 */
        #hidden-gallery-source {
            display: none;
        }

        /* 模态框 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal img {
            max-width: 95%;
            max-height: 95%;
            border: 1px solid var(--primary);
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 2rem;
            color: #fff;
            cursor: pointer;
        }
    </style>
</head>

<body>

    <header class="hero-section">
        <div
            style="position:absolute; width:100%; height:100%; background: linear-gradient(0deg, transparent 95%, var(--primary) 100%); opacity:0.1; animation: scan 3s infinite linear;">
        </div>

        <div class="hero-content">
            <h1 class="hero-title">${HERO_TITLE}</h1>
            <div class="hero-subtitle">SYSTEM STATUS: ONLINE // UPDATED: ${UPDATED_AT}</div>
        </div>

        <div class="carousel-container">
            <div class="carousel-track" id="carousel-track">
            </div>
        </div>

        <div class="carousel-nav">
            <div class="nav-btn-circle" onclick="rotateCarousel(-1)">&#8592;</div>
            <div class="nav-btn-circle" onclick="rotateCarousel(1)">&#8594;</div>
        </div>
    </header>

    <nav class="main-nav">
        <div class="nav-tab active" onclick="switchTab('general')">综合分析 (General)</div>
        <div class="nav-tab" onclick="switchTab('ml')">智能预测 (ML Core)</div>
    </nav>

    <div id="hidden-gallery-source">
        ${STATIC_CHARTS}
    </div>

    <div class="container">

        <div id="tab-general" class="content-section active">

            <div class="metrics-grid">
                ${METRIC_CARDS}
            </div>

            <div class="module-card">
                <div class="module-header">
                    <span>///</span> 市场趋势全览
                </div>
                <div class="module-body">
                    <div class="grid-2">
                        <div class="chart-scroll-wrapper">
                            <div class="chart-container wide-chart">${yearly_line}</div>
                        </div>
                        <div class="chart-scroll-wrapper">
                            <div class="chart-container wide-chart">${region_stream}</div>
                        </div>
                    </div>
                    <div style="margin-top: 20px;">
                        <h4 style="color:var(--text-dim)">动量指标</h4>
                        <div class="data-list">${MOMENTUM}</div>
                    </div>
                </div>
            </div>

            <div class="grid-2">
                <div class="module-card">
                    <div class="module-header"><span>///</span> 游戏类型分布</div>
                    <div class="module-body">
                        <div class="chart-scroll-wrapper">
                            <div class="chart-container">${genre_bar}</div>
                        </div>
                        <div class="data-list" style="margin-top:15px; max-height:150px; overflow-y:auto;">
                            ${TOP_GENRES}
                        </div>
                    </div>
                </div>
                <div class="module-card">
                    <div class="module-header"><span>///</span> 平台家族份额</div>
                    <div class="module-body">
                        <div class="chart-scroll-wrapper">
                            <div class="chart-container">${platform_pie}</div>
                        </div>
                        <div class="data-list" style="margin-top:15px; max-height:150px; overflow-y:auto;">
                            ${PLATFORM_SHARES}
                        </div>
                    </div>
                </div>
            </div>

            <div class="module-card">
                <div class="module-header"><span>///</span> 平台-类型 热力矩阵</div>
                <div class="module-body">
                    <div class="chart-scroll-wrapper">
                        <div class="chart-container" style="min-width: 1400px; height: 600px;">
                            ${platform_heatmap}
                        </div>
                    </div>
                    <div style="text-align:center; color:var(--text-dim); margin-top:5px; font-size:0.8rem;">
                        <span style="border:1px solid var(--text-dim); padding:2px 5px; border-radius:3px;">提示</span>
                        如果内容显示不全，请横向滑动图表区域
                    </div>
                </div>
            </div>

            <div class="module-card">
                <div class="module-header"><span>///</span> 区域战略情报</div>
                <div class="module-body">
                    <div class="grid-2">
                        <div class="chart-scroll-wrapper">
                            <div class="chart-container">${region_radar}</div>
                        </div>
                        <div class="chart-scroll-wrapper">
                            <div class="chart-container">${region_sunburst}</div>
                        </div>
                    </div>
                    <div class="grid-2" style="margin-top:20px;">
                        <div>
                            <h4 style="color:var(--text-dim)">区域偏好</h4>
                            <div class="data-list">${REGION_PREFERENCES}</div>
                        </div>
                        <div>
                            <h4 style="color:var(--text-dim)">发行商壁垒</h4>
                            <div class="data-list">${PUBLISHER_MOAT}</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="module-card">
                <div class="module-header"><span>///</span> 平台迁移流向</div>
                <div class="module-body">
                    <div class="chart-scroll-wrapper">
                        <div class="chart-container wide-chart" style="height: 600px;">
                            ${sankey_flow}
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <div id="tab-ml" class="content-section">
            <div class="grid-2">
                <div class="module-card">
                    <div class="module-header"><span>///</span> 模型性能评估</div>
                    <div class="module-body">
                        <div class="chart-scroll-wrapper">
                            <div class="chart-container">${ml_r2_gauge}</div>
                        </div>
                        <div class="data-list" style="margin-top:15px;">${ML_INSIGHTS}</div>
                    </div>
                </div>
                <div class="module-card">
                    <div class="module-header"><span>///</span> 关键特征因子</div>
                    <div class="module-body">
                        <div class="chart-scroll-wrapper">
                            <div class="chart-container">${ml_feature_importance}</div>
                        </div>
                        <div class="data-list" style="margin-top:15px;">${ML_FEATURES}</div>
                    </div>
                </div>
            </div>

            <div class="module-card">
                <div class="module-header"><span>///</span> 智能聚类与细分</div>
                <div class="module-body">
                    <div class="grid-2">
                        <div>
                            <h4 style="color:var(--secondary)">>> 区域聚类</h4>
                            <div class="data-list">${ML_SEGMENTS}</div>
                        </div>
                        <div>
                            <h4 style="color:var(--accent)">>> 行为特征</h4>
                            <div class="data-list">${ML_BEHAVIOR}</div>
                        </div>
                    </div>
                    <div style="margin-top:20px; padding-top:10px; border-top:1px dashed #333">
                        <h4 style="color:var(--primary)">>> 聚类洞察</h4>
                        <div class="data-list">${CLUSTER_INSIGHTS}</div>
                    </div>
                </div>
            </div>

            <div class="module-card">
                <div class="module-header"><span>///</span> 相似性推荐引擎</div>
                <div class="module-body">
                    <div class="data-list">${ML_SIMILARITY}</div>
                </div>
            </div>
        </div>

    </div>

    <div id="img-modal" class="modal" onclick="this.classList.remove('active')">
        <span class="modal-close">&times;</span>
        <img id="modal-img-target" src="" />
    </div>

    <script>
        // --- 1. 静态图片轮播逻辑 (3D Carousel) ---
        let currDeg = 0;
        const track = document.getElementById('carousel-track');
        const source = document.getElementById('hidden-gallery-source');

        // 从隐藏区域提取图片并构建轮播 Item
        const rawItems = source.querySelectorAll('.gallery-item'); // 假设原始生成的结构是这个
        // 如果原始结构比较乱，我们只提取 img 标签
        const imgs = source.querySelectorAll('img');

        if (imgs.length > 0) {
            imgs.forEach((img, index) => {
                const item = document.createElement('div');
                item.className = 'carousel-item';
                // 提取标题 (假设是 img 的 alt 或者父级的文本)
                const title = img.alt || `Analysis Chart ${index + 1}`;

                // 修正图片路径 (解码 URL)
                const src = decodeURIComponent(img.src);

                item.innerHTML = `
                    <img src="${src}" onclick="openModal('${src}')">
                    <div class="carousel-caption">${title}</div>
                `;
                track.appendChild(item);
            });
            setupCarousel();
        } else {
            // 如果没有图片，放入占位符
            track.innerHTML = '<div class="carousel-item"><div style="display:flex;justify-content:center;align-items:center;height:100%;">NO VISUAL DATA</div></div>';
        }

        function setupCarousel() {
            const items = document.querySelectorAll('.carousel-item');
            const n = items.length;
            const angle = 360 / n;
            // 计算半径：让卡片稍微分开
            const radius = Math.round((400 / 2) / Math.tan(Math.PI / n)) + 50;

            items.forEach((item, index) => {
                item.style.transform = `rotateY(${index * angle}deg) translateZ(${radius}px)`;
            });
        }

        function rotateCarousel(dir) {
            const items = document.querySelectorAll('.carousel-item');
            const angle = 360 / items.length;
            currDeg += dir * angle;
            track.style.transform = `rotateY(${currDeg}deg)`;
        }

        // 自动播放
        let autoPlay = setInterval(() => rotateCarousel(-1), 5000);
        document.querySelector('.hero-section').addEventListener('mouseenter', () => clearInterval(autoPlay));
        document.querySelector('.hero-section').addEventListener('mouseleave', () => autoPlay = setInterval(() => rotateCarousel(-1), 5000));


        // --- 2. 标签页切换 ---
        function switchTab(id) {
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');

            document.querySelectorAll('.content-section').forEach(s => {
                s.style.display = 'none';
                s.classList.remove('active');
            });

            const active = document.getElementById('tab-' + id);
            active.style.display = 'block';

            // 触发重绘以修复 ECharts 在 display:none 下的大小问题
            requestAnimationFrame(() => {
                active.classList.add('active');
                window.dispatchEvent(new Event('resize'));
            });
        }

        // --- 3. 模态框 ---
        function openModal(src) {
            document.getElementById('modal-img-target').src = src;
            document.getElementById('img-modal').classList.add('active');
        }

        // --- 4. 样式修正 ---
        // 修正原始 metric-card 的样式（如果无法完全通过 CSS 覆盖）
        window.addEventListener('load', () => {
            const cards = document.querySelectorAll('.metric-card');
            cards.forEach(card => {
                card.className = 'kpi-card'; // 替换为我们的类
                const h3 = card.querySelector('h3');
                if (h3) h3.className = 'kpi-title';
                const p = card.querySelector('p');
                if (p) p.className = 'kpi-value';
            });
        });

        // --- 5. 扫描线动画关键帧 ---
        const style = document.createElement('style');
        style.innerHTML = `
            @keyframes scan {
                0% { transform: translateY(-100%); }
                100% { transform: translateY(100%); }
            }
        `;
        document.head.appendChild(style);

    </script>
</body>

</html>